<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Breakout Clone - Web Designer Gamer Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    :root {
      --neu-bg: #e0e5ec;
      --neu-light: #ffffff;
      --neu-dark: #a3b1c6;
      --neu-darker: #9baacf;
      --neu-shadow-light: 12px 12px 20px var(--neu-darker);
      --neu-shadow-dark: -8px -8px 20px var(--neu-light);
      --neu-shadow-inset-light: inset 6px 6px 12px var(--neu-darker);
      --neu-shadow-inset-dark: inset -6px -6px 12px var(--neu-light);
      --accent-primary: #667eea;
      --accent-secondary: #764ba2;
      --text-primary: #2d3748;
      --text-secondary: #4a5568;
      --text-muted: #718096;
      --success: #48bb78;
      --warning: #ed8936;
      --danger: #f56565;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: var(--neu-bg);
      font-family: 'Inter', 'Segoe UI', sans-serif;
      color: var(--text-primary);
      min-height: 100vh;
      user-select: none;
      overflow: hidden;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      min-height: 640px;
      background: linear-gradient(135deg, #e0e5ec 0%, #d4d9e0 100%);
    }

    .container {
      background: var(--neu-bg);
      box-shadow: var(--neu-shadow-light), var(--neu-shadow-dark);
      border-radius: 24px;
      display: flex;
      padding: 32px 40px;
      gap: 40px;
      align-items: flex-start;
      min-width: 900px;
      max-width: 95vw;
      min-height: 560px;
      position: relative;
    }

    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 32px;
      min-width: 220px;
      width: 240px;
      padding-top: 20px;
    }

    .sidebar h2 {
      margin: 0 0 16px 0;
      font-size: 2.2rem;
      font-weight: 700;
      letter-spacing: -0.5px;
      color: var(--text-primary);
      text-align: center;
      position: relative;
    }

    .sidebar h2::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 4px;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      border-radius: 2px;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }

    .info-box {
      background: var(--neu-bg);
      border-radius: 18px;
      padding: 24px 20px;
      box-shadow: var(--neu-shadow-inset-light), var(--neu-shadow-inset-dark);
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .info-box:hover {
      transform: translateY(-2px);
    }

    .info-box label {
      display: block;
      font-weight: 500;
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 8px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }

    .info-box span {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.4rem;
      font-weight: 700;
      color: var(--text-primary);
      position: relative;
      min-height: 50px;
    }

    /* Animated counters */
    .score-display {
      background: linear-gradient(135deg, var(--success), #38a169);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .level-display {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .lives-display {
      background: linear-gradient(135deg, var(--danger), #e53e3e);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Lives hearts */
    #lives {
      display: flex;
      gap: 6px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }

    .heart {
      color: var(--danger);
      font-size: 1.8rem;
      animation: heartbeat 1.5s ease-in-out infinite;
      text-shadow: 0 2px 4px rgba(245, 101, 101, 0.3);
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .controls {
      background: var(--neu-bg);
      border-radius: 16px;
      padding: 20px 24px;
      box-shadow: var(--neu-shadow-inset-light), var(--neu-shadow-inset-dark);
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 20px;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
    }

    .control-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      flex: 1;
    }

    .control-label {
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 500;
      letter-spacing: 0.3px;
    }

    .controls strong {
      color: var(--text-primary);
      font-weight: 600;
    }

    .key-hint {
      display: inline-block;
      background: var(--neu-bg);
      box-shadow: 2px 2px 4px var(--neu-darker), -2px -2px 4px var(--neu-light);
      border-radius: 6px;
      padding: 2px 8px;
      font-size: 12px;
      font-weight: 600;
      margin: 0 2px;
      color: var(--text-primary);
    }

    canvas {
      display: block;
      background: var(--neu-bg);
      box-shadow: var(--neu-shadow-inset-light), var(--neu-shadow-inset-dark);
      border-radius: 20px;
      margin: auto;
      max-width: 100%;
      height: auto;
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }

    canvas:hover {
      box-shadow: 
        inset 8px 8px 16px var(--neu-darker), 
        inset -8px -8px 16px var(--neu-light),
        0 0 20px rgba(102, 126, 234, 0.1);
    }

    .game-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--neu-bg);
      border-radius: 20px;
      padding: 40px 60px;
      color: var(--text-primary);
      box-shadow: var(--neu-shadow-light), var(--neu-shadow-dark);
      font-size: 2.2rem;
      font-weight: 600;
      text-align: center;
      z-index: 1000;
      pointer-events: none;
      user-select: none;
      display: none;
      border: 2px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
    }

    .canvas-container {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .game-message.show {
      display: block;
      pointer-events: auto;
      animation: messageSlide 0.4s ease-out;
    }

    @keyframes messageSlide {
      from {
        opacity: 0;
        transform: translate(-50%, -60%);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%);
      }
    }

    .game-message small {
      font-size: 1.2rem;
      color: var(--text-muted);
      font-weight: 400;
    }

    /* Score animation */
    @keyframes scoreUpdate {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    .score-animate {
      animation: scoreUpdate 0.3s ease-out;
    }

    /* Level progression indicator */
    .level-progress {
      width: 100%;
      height: 4px;
      background: var(--neu-bg);
      border-radius: 2px;
      margin-top: 12px;
      box-shadow: var(--neu-shadow-inset-light), var(--neu-shadow-inset-dark);
      overflow: hidden;
    }

    .level-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
      border-radius: 2px;
      transition: width 0.5s ease;
      box-shadow: 0 0 8px rgba(102, 126, 234, 0.4);
    }

    @media (max-width: 1080px) {
      .container {
        min-width: 700px;
        padding: 20px 24px;
        gap: 24px;
      }
      .sidebar {
        min-width: 180px;
        width: 200px;
      }
      .game-message {
        padding: 24px 40px;
        font-size: 1.6rem;
      }
    }

    @media (max-width: 800px) {
      .container {
        flex-direction: column;
        align-items: center;
        min-width: unset;
        width: 98vw;
        min-height: unset;
        padding: 16px;
        box-shadow: none;
        background: transparent;
      }
      .sidebar {
        flex-direction: row;
        min-width: unset;
        width: 100%;
        gap: 16px;
        margin-bottom: 16px;
        flex-wrap: wrap;
        justify-content: center;
      }
      .info-box {
        padding: 16px 12px;
        flex: 1;
        min-width: 120px;
      }
      .controls {
        width: 100%;
        max-width: 500px;
        padding: 16px 20px;
        margin-top: 16px;
        gap: 16px;
      }
      .control-label {
        font-size: 12px;
      }
      .game-message {
        padding: 20px 24px;
        font-size: 1.4rem;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="sidebar">
    <h2>Breakout</h2>
    <div class="info-box">
      <label>Score</label>
      <span id="score" class="score-display">0</span>
    </div>
    <div class="info-box">
      <label>Level</label>
      <span id="level" class="level-display">1</span>
      <div class="level-progress">
        <div class="level-progress-bar" id="levelProgress" style="width: 0%"></div>
      </div>
    </div>
    <div class="info-box">
      <label>Lives</label>
      <span id="lives" class="lives-display"></span>
    </div>
  </div>
  <div class="canvas-container">
    <canvas id="gameCanvas"></canvas>
    <div class="game-message" id="gameMessage"></div>
    <div class="controls">
      <div class="control-item">
        <span class="key-hint">←</span> <span class="key-hint">→</span>
        <div class="control-label">Move Paddle</div>
      </div>
      <div class="control-item">
        <span class="key-hint">Space</span> <span class="key-hint">Enter</span>
        <div class="control-label">Start/Pause</div>
      </div>
      <div class="control-item">
        <span class="key-hint">R</span>
        <div class="control-label">Restart Game</div>
      </div>
    </div>
  </div>
</div>
<script>
(function() {
  // Configurable values
  const DESKTOP_BASE_WIDTH = 620;
  const DESKTOP_BASE_HEIGHT = 480;
  const MIN_WIDTH = 380, MAX_WIDTH = 820;
  const MIN_HEIGHT = 360, MAX_HEIGHT = 720;

  // Responsive canvas
  const canvas = document.getElementById('gameCanvas');
  let ctx = canvas.getContext('2d');

  // Sidebar UI
  const scoreElem = document.getElementById('score');
  const levelElem = document.getElementById('level');
  const livesElem = document.getElementById('lives');
  const levelProgressElem = document.getElementById('levelProgress');
  const messageElem = document.getElementById('gameMessage');

  // --- GAME STATE ---
  let width, height, dpr;
  let paddle, ball, bricks;
  let score = 0, level = 1, lives = 3;
  let isRunning = false, isGameOver = false, isVictory = false, isPaused = false;
  let leftPressed = false, rightPressed = false;
  let animationFrameId;
  let brickRows, brickCols, brickPadding, brickOffsetTop, brickWidth, brickHeight;
  let paddleW, paddleH, paddleY, paddleSpeed, paddleRadius;
  let ballRadius, ballSpeed, ballMaxSpeed;
  let colors, brickTypes;
  let keyDownHandled = {};
  let totalBricks = 0, initialBricks = 0;

  // --- AUDIO ---
  const sounds = {
    paddle: new Audio(),
    brick: new Audio(),
    wall: new Audio(),
    lose: new Audio(),
    win: new Audio(),
    life: new Audio()
  };
  // High-quality synthesized game sounds
  sounds.paddle.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8thyJQUsgc7y2HIlBSyBzvLYciUFLIHO8thyJQUsgc7y2HIlBSyBzvLYciUFLIHO8thyJQUsgc7y2HIlBSyBzvLYciUFLIHO8thyJQUsgc7y2HIlBSyBzvLYcSsFLIHO8thzJwc+gM/w2HMnBz6Az/DY';
  sounds.brick.src  = 'data:audio/wav;base64,UklGRsgBAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YSQBAAC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4gYKCg4SEhYaHiImKi4yNjo+QkZKTlJWWl5iZmpucnZ6foKGio6SlpqeoqaqrrK2ur7CxsrO0tba3uLm6u7y9vr/AwcLDxMTFxsfHyMjJysvMzc3OztDP0NDR0tPU1NXW19fY2drc3d3e3+Dh4uPk5OXm5+jp6uvs7e7v8PHy8/T09fb3+Pn6+/z9/v8AAAAAAQIDBAUGBwgJCgsMDQ4PEBESExQVFhcYGRobHB0eHyAhIiMkJSYnKCkqKywtLi8wMTIzNDU2Nzg5Ojs8PT4/QEFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaW1xdXl9gYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXp7fH1+f4CBgoOEhIaGiIiJiYqKi4uMjIyNjY2Ojo6Oj4+Pj5CQkJCQkZGRkZKSkpKSkpOTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5M=';
  sounds.wall.src   = 'data:audio/wav;base64,UklGRvQBAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQABAAD//v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7//v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7';
  sounds.lose.src   = 'data:audio/wav;base64,UklGRmQDAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YUADAAC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4gYKCg4SEhYaHiImKi4yNjo+QkZKTlJWWl5iZmpucnZ6foKGio6SlpqeoqaqrrK2ur7CxsrO0tba3uLm6u7y9vr/AwcLDxMTFxsfHyMjJysvMzc3OztDP0NDR0tPU1NXW19fY2drc3d3e3+Dh4uPk5OXm5+jp6uvs7e7v8PHy8/T09fb3+Pn6+/z9/v8AAAAAAQIDBAUGBwgJCgsMDQ4PEBESExQVFhcYGRobHB0eHyAhIiMkJSYnKCkqKywtLi8wMTIzNDU2Nzg5Ojs8PT4/QEFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaW1xdXl9gYWJjZGVmZ2hpamtsbW5vcA==';
  sounds.win.src    = 'data:audio/wav;base64,UklGRrgEAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQQEAAD/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////';
  sounds.life.src   = 'data:audio/wav;base64,UklGRswCAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YWgCAABmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZgA=';

  function playSound(type) {
    let s = sounds[type];
    if (!s) return;
    try {
      s.currentTime = 0;
      s.play();
    } catch(e) {/* play() may fail if user hasn't interacted yet */}
  }

  // --- UTILS ---
  function clamp(val, min, max) { return Math.max(min, Math.min(val, max)); }

  function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

  // --- GAME INITIALIZATION ---
  function setupDimensions() {
    // Desktop, keep aspect ratio, scale with container
    let availW = Math.min(window.innerWidth-350, MAX_WIDTH);
    let availH = Math.min(window.innerHeight-90, MAX_HEIGHT);
    width = clamp(availW, MIN_WIDTH, MAX_WIDTH);
    // Maintain 1.4:1 aspect ratio
    height = clamp(Math.round(width/1.4), MIN_HEIGHT, MAX_HEIGHT);
    dpr = window.devicePixelRatio || 1;
    canvas.width = width * dpr;
    canvas.height = height * dpr;
    canvas.style.width = width + 'px';
    canvas.style.height = height + 'px';
    ctx.setTransform(1,0,0,1,0,0);
    ctx.scale(dpr, dpr);
  }

  function setupColors() {
    // Modern neumorphic color palette
    colors = [
      "#667eea", "#764ba2", "#f093fb", "#f5576c",
      "#4facfe", "#00f2fe", "#43e97b", "#38f9d7",
      "#ffecd2", "#fcb69f", "#a8edea", "#fed6e3"
    ];
    brickTypes = [
      // type: { color, hits }
      { color: colors[0], hits: 1 },
      { color: colors[2], hits: 1 },
      { color: colors[6], hits: 1 },
      { color: colors[4], hits: 2 }, // 2-hit
      { color: colors[1], hits: 2 },
      { color: colors[3], hits: 3 }  // 3-hit (rare, upper level)
    ];
  }

  function setupLevelParams() {
    // Level affects number of rows, speed etc.
    brickRows = clamp(4 + Math.floor(level*0.7), 5, 10 + Math.floor(level/2));
    brickCols = clamp(Math.floor(width/61), 7, 14);
    brickPadding = clamp(width*0.011, 6, 18);
    brickOffsetTop = clamp(height*0.07, 30, 56);
    brickWidth = ((width - 2*brickPadding) / brickCols) - brickPadding;
    brickHeight = clamp(height*0.045, 17, 32);

    paddleW = clamp(width*0.19, 62, 150);
    paddleH = clamp(height*0.025, 13, 22);
    paddleY = height - paddleH - clamp(height*0.04, 16, 38);
    paddleSpeed = clamp(width*0.012 + level*0.29, 5, 16 + level);
    paddleRadius = Math.max(7, paddleH * 0.66);

    ballRadius = clamp(width*0.017 + level*0.6, 8, Math.max(16, paddleH*1.51));
    ballSpeed = clamp(4.2 + (level-1)*0.64, 4.5, 13 + level*0.5);
    ballMaxSpeed = clamp(8 + level*0.7, 8, 18 + level);
  }

  function createBricks() {
    bricks = [];
    let hardRow = Math.floor((level-1) / 2);
    totalBricks = 0;
    for (let r=0; r < brickRows; r++) {
      bricks[r] = [];
      for (let c=0; c < brickCols; c++) {
        let typeIndex = 0;
        if (r < 1) typeIndex = 5;       // Top row: tough
        else if (r <= hardRow) typeIndex = randInt(3,4);
        else if (r % 2 === 0 && Math.random()>0.7) typeIndex = 4;
        else if (r % 3 === 0 && Math.random()>0.65) typeIndex = 1;
        else typeIndex = randInt(0,2);

        // Add gaps randomly for some variety after level 3
        if (level > 3 && Math.random() > 0.87 && r>1) {
          bricks[r][c] = null;
          continue;
        }
        bricks[r][c] = {
          x: c*(brickWidth+brickPadding) + brickPadding,
          y: r*(brickHeight+brickPadding) + brickOffsetTop,
          hits: brickTypes[typeIndex].hits,
          color: brickTypes[typeIndex].color,
          type: typeIndex
        };
        totalBricks++;
      }
    }
    initialBricks = totalBricks;
  }

  function setupPaddle() {
    paddle = {
      x: (width-paddleW)/2,
      y: paddleY,
      w: paddleW,
      h: paddleH,
      speed: paddleSpeed,
      dx: 0,
      radius: paddleRadius
    };
  }

  function setupBall() {
    ball = {
      x: width/2,
      y: paddle.y - ballRadius - 3,
      r: ballRadius,
      speed: ballSpeed,
      angle: randInt(48,132) * Math.PI/180, // 48-132 deg
      dx: 0,
      dy: 0,
      isStuck: true // Starts stuck to paddle
    };
    updateBallVelocity();
  }

  function updateBallVelocity() {
    ball.dx = ball.speed * Math.cos(ball.angle);
    ball.dy = -Math.abs(ball.speed * Math.sin(ball.angle));
  }

  function launchBall() {
    if (!ball.isStuck) return;
    ball.isStuck = false;
    updateBallVelocity();
  }

  function resetBallAndPaddle(stick=true) {
    setupPaddle();
    setupBall();
    ball.isStuck = stick;
  }

  function resetGame() {
    score = 0;
    level = 1;
    lives = 3;
    isGameOver = false;
    isVictory = false;
    isPaused = false;
    keyDownHandled = {};
    setupLevel();
    updateSidebar();
    showMessage('Press Space or Enter to Start');
  }

  function setupLevel() {
    setupLevelParams();
    createBricks();
    setupPaddle();
    setupBall();
    isRunning = false;
    isPaused = false;
    updateSidebar();
    if (level===1) showMessage('Press Space or Enter to Start');
    else showMessage('Level '+level+'<br>Press Space/Enter');
  }

  // --- INPUT HANDLING ---
  document.addEventListener('keydown', function(e){
    if (e.repeat) return;
    switch(e.code) {
      case "ArrowLeft":
      case "KeyA":
        leftPressed = true;
        break;
      case "ArrowRight":
      case "KeyD":
        rightPressed = true;
        break;
      case "Space":
      case "Enter":
        if (!isGameOver && !isVictory) {
          if (!isRunning) {
            isRunning = true;
            isPaused = false;
            hideMessage();
            if (ball.isStuck) launchBall();
            gameLoop();
          } else if (ball.isStuck) {
            hideMessage();
            launchBall();
          } else {
            // Pause
            isPaused = !isPaused;
            showMessage(isPaused ? 'Paused<br>Press Space/Enter' : '');
            if (!isPaused) {
              hideMessage();
              gameLoop();
            }
          }
        }
        break;
      case "KeyR":
        resetGame();
        break;
    }
  });
  document.addEventListener('keyup', function(e){
    switch(e.code) {
      case "ArrowLeft":
      case "KeyA":
        leftPressed = false;
        break;
      case "ArrowRight":
      case "KeyD":
        rightPressed = false;
        break;
    }
  });

  // --- UI / MESSAGE ---
  function showMessage(html) {
    if (!html) { hideMessage(); return; }
    messageElem.innerHTML = html;
    messageElem.classList.add('show');
  }
  function hideMessage() {
    messageElem.classList.remove('show');
  }

  function updateSidebar() {
    // Animate score update
    if (scoreElem.textContent !== score.toString()) {
      scoreElem.classList.add('score-animate');
      setTimeout(() => scoreElem.classList.remove('score-animate'), 300);
    }
    scoreElem.textContent = score.toLocaleString();
    levelElem.textContent = level;
    
    // Update lives with hearts
    livesElem.innerHTML = '';
    for (let i = 0; i < lives; i++) {
      const heart = document.createElement('span');
      heart.className = 'heart';
      heart.innerHTML = '♥';
      heart.style.animationDelay = `${i * 0.1}s`;
      livesElem.appendChild(heart);
    }
    
    // Update level progress
    if (initialBricks > 0) {
      const remainingBricks = bricks.flat().filter(x => x).length;
      const progress = ((initialBricks - remainingBricks) / initialBricks) * 100;
      levelProgressElem.style.width = `${Math.max(0, Math.min(100, progress))}%`;
    }
  }

  // --- GAME LOOP ---
  function gameLoop() {
    if (!isRunning || isPaused) return;
    animationFrameId = requestAnimationFrame(gameLoop);
    update();
    render();
  }

  function update() {
    // Paddle movement
    if (leftPressed) {
      paddle.x -= paddle.speed;
    }
    if (rightPressed) {
      paddle.x += paddle.speed;
    }
    paddle.x = clamp(paddle.x, 0, width-paddle.w);

    // Ball update
    if (ball.isStuck) {
      ball.x = paddle.x + paddle.w/2;
      ball.y = paddle.y - ball.r - 3;
    } else {
      ball.x += ball.dx;
      ball.y += ball.dy;
      // Collisions
      handleBallCollisions();
    }

    // Victory check
    if (bricks.flat().filter(x=>x).length === 0) {
      level++;
      playSound('win');
      setTimeout(function(){
        setupLevel();
      }, 650);
      isRunning = false;
      return;
    }
  }

  function handleBallCollisions() {
    // Walls
    if ((ball.x - ball.r) <= 0) {
      ball.x = ball.r+1;
      ball.dx *= -1;
      playSound('wall');
    }
    if ((ball.x + ball.r) >= width) {
      ball.x = width - ball.r-1;
      ball.dx *= -1;
      playSound('wall');
    }
    if ((ball.y - ball.r) <= 0) {
      ball.y = ball.r+1;
      ball.dy *= -1;
      playSound('wall');
    }

    // Paddle
    if (ball.y + ball.r >= paddle.y && ball.y + ball.r <= paddle.y + paddle.h
        && ball.x + ball.r > paddle.x && ball.x - ball.r < paddle.x + paddle.w) {
      // Hit!
      let relativeIntersectX = (ball.x - (paddle.x + paddle.w/2));
      let norm = relativeIntersectX / (paddle.w/2);
      // Angle: 45deg (side) to 135deg (side), 90deg (center)
      let bounceAngle = Math.PI/2 + norm * Math.PI/3; // +/-60deg
      ball.dx = ball.speed * Math.cos(bounceAngle);
      ball.dy = -Math.abs(ball.speed * Math.sin(bounceAngle));
      // Speed up a little
      ball.speed = clamp(ball.speed + 0.14, ballSpeed, ballMaxSpeed);
      playSound('paddle');
      // Stick to paddle if pressing down (skill move)
    }
    // Ball below paddle: lose life
    if ((ball.y - ball.r) > height) {
      lives--;
      playSound('life');
      if (lives <= 0) {
        isGameOver = true;
        isRunning = false;
        playSound('lose');
        showMessage('Game Over<br><small>Press R to Restart</small>');
      } else {
        updateSidebar();
        showMessage('Life Lost<br>Press Space/Enter');
        resetBallAndPaddle(true);
        isRunning = false;
      }
    }

    // Bricks collision (AABB, check only near bricks)
    let row = Math.floor((ball.y - brickOffsetTop)/(brickHeight+brickPadding));
    let possibleRows = [clamp(row-1,0,brickRows-1), clamp(row,0,brickRows-1), clamp(row+1,0,brickRows-1)];
    let hit = false;
    for (let r of possibleRows) {
      for (let c=0; c<brickCols; c++) {
        let brick = bricks[r][c];
        if (!brick) continue;
        // Circle-rect collision
        if (ball.x + ball.r > brick.x && ball.x - ball.r < brick.x + brickWidth &&
            ball.y + ball.r > brick.y && ball.y - ball.r < brick.y + brickHeight) {
          // Reduce brick
          brick.hits--;
          playSound('brick');
          if (brick.hits <= 0) {
            bricks[r][c] = null;
            score += 5 + brick.type*3 + level;
          } else {
            brick.color = colors[randInt(0,colors.length-1)];
            score += 2;
          }
          updateSidebar();
          // Collide: reflect ball intelligently (top/bottom/side)
          // Check which side
          let prevX = ball.x - ball.dx, prevY = ball.y - ball.dy;
          let collidedVert = (prevY + ball.r <= brick.y || prevY - ball.r >= brick.y + brickHeight);
          if (collidedVert) {
            ball.dy *= -1;
          } else {
            ball.dx *= -1;
          }
          hit = true;
          break;
        }
      }
      if (hit) break;
    }
  }

  // --- RENDER ---
  function render() {
    // Clear with neumorphic background
    ctx.fillStyle = '#e0e5ec';
    ctx.fillRect(0, 0, width, height);

    // Bricks
    for (let r=0; r<brickRows; r++) {
      for (let c=0; c<brickCols; c++) {
        let brick = bricks[r][c];
        if (!brick) continue;
        drawBrick(brick);
      }
    }

    // Paddle
    drawPaddle();

    // Ball
    drawBall();

    // HUD overlay (paused, gameover)
    if (isGameOver) {
      ctx.save();
      ctx.globalAlpha = 0.6;
      ctx.fillStyle = "#e0e5ec";
      ctx.fillRect(0,0,width,height);
      ctx.restore();
    }
  }

  function drawBrick(brick) {
    ctx.save();
    ctx.beginPath();
    ctx.rect(brick.x, brick.y, brickWidth, brickHeight);
    ctx.fillStyle = brick.color;
    ctx.shadowColor = "#000";
    ctx.shadowBlur = 7;
    ctx.fill();
    ctx.closePath();
    ctx.shadowBlur = 0;

    // 2/3 hit bricks overlay
    if (brick.hits >= 2) {
      ctx.beginPath();
      ctx.rect(brick.x, brick.y, brickWidth, brickHeight);
      ctx.globalAlpha = 0.42;
      ctx.fillStyle = "#fcfcfc";
      ctx.fill();
      ctx.closePath();
      ctx.globalAlpha = 1.0;
    }
    ctx.restore();
  }

  function drawPaddle() {
    ctx.save();
    ctx.beginPath();
    // Rounded rectangle
    let r = paddle.radius;
    let {x, y, w, h} = paddle;
    ctx.moveTo(x+r, y);
    ctx.lineTo(x+w-r, y);
    ctx.quadraticCurveTo(x+w, y, x+w, y+r);
    ctx.lineTo(x+w, y+h-r);
    ctx.quadraticCurveTo(x+w, y+h, x+w-r, y+h);
    ctx.lineTo(x+r, y+h);
    ctx.quadraticCurveTo(x, y+h, x, y+h-r);
    ctx.lineTo(x, y+r);
    ctx.quadraticCurveTo(x, y, x+r, y);
    ctx.closePath();
    ctx.fillStyle = "#3788fa";
    ctx.shadowColor = "#17355d";
    ctx.shadowBlur = 16;
    ctx.fill();
    ctx.restore();
  }

  function drawBall() {
    ctx.save();
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.r, 0, 2*Math.PI);
    let grad = ctx.createRadialGradient(ball.x, ball.y, ball.r*0.3, ball.x, ball.y, ball.r);
    grad.addColorStop(0, "#fcfcfc");
    grad.addColorStop(0.35, "#fff7cf");
    grad.addColorStop(1, "#eab308");
    ctx.fillStyle = grad;
    ctx.shadowColor = "#d6b81d";
    ctx.shadowBlur = 14;
    ctx.fill();
    ctx.closePath();
    ctx.restore();
  }

  // --- RESPONSIVE RESIZE ---
  window.addEventListener('resize', function(){
    cancelAnimationFrame(animationFrameId);
    setupDimensions();
    setupLevelParams();
    updateSidebar();
    render();
  });

  // --- STARTUP ---
  function start() {
    setupDimensions();
    setupColors();
    resetGame();
    render();
  }

  // Start after DOM loaded
  window.addEventListener('DOMContentLoaded', start);

})();
</script>
</body>
</html>